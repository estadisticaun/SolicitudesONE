---
title: "Análisis Encuesta"
author: "Alberto Rodríguez R"
date: '2022-06-24'
output: 
  word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{css, echo=FALSE}
body {
  font-family: "Noto Sans", sans-serif; 
  font-size: 1.5rem;
  text-align: justify;
}
```

```{r, echo=FALSE, eval=TRUE, warning=FALSE, message=FALSE}
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
```


```{r, echo=FALSE, eval=TRUE}
# Importar y transformar datos

ProyectoB <- read_excel("Datos/Fuentes/Encuesta ProyectoB.xlsx")

# Crear factores

ProyectoB$Pregunta1 <- factor(ProyectoB$Pregunta1, levels = c("Sí", "Tal vez", "No"))
ProyectoB$Pregunta2 <- factor(ProyectoB$Pregunta2, levels = c("Sí", "Tal vez", "No"))
ProyectoB$Pregunta3 <- factor(ProyectoB$Pregunta3, levels = c("Sí", "No"))
ProyectoB$Pregunta4 <- factor(ProyectoB$Pregunta4, levels = c("Sí", "Tal vez", "No"))
ProyectoB$Pregunta5 <- factor(ProyectoB$Pregunta5, levels = c("Sí", "No"))
```

# Gráfico General

```{r, echo=FALSE, eval=TRUE}
percentData <- ProyectoB %>%  pivot_longer(Pregunta1:Pregunta5, 
                           names_to = "Preguntas", 
                           values_to = "Respuestas") %>% 
                           group_by(Preguntas) %>% count(Respuestas) %>%
    mutate(N = n/sum(n),
           ratio=scales::percent(n/sum(n)))

ProyectoB %>% pivot_longer(Pregunta1:Pregunta5, 
                           names_to = "Preguntas", 
                           values_to = "Respuestas") %>% 
  ggplot(aes(x = Preguntas, fill = Respuestas))+
  geom_bar(position = position_fill(reverse = TRUE)) + 
  labs(x = " \nPreguntas",
       y = "Porcentaje")+
  geom_hline(yintercept=0.7, col = "blue", linetype="dashed", size = 1.3)+
  scale_y_continuous(limits=c(0, 1),
                      breaks = seq(0, 1, .2),
                     label = c('0%', '20%', '40%', '60%', '80%', '100%')) +
    geom_text(data=percentData, aes(y=N,label=ratio),
              position = position_fill(vjust = 0.5, reverse = TRUE))+
  theme(legend.position = "bottom")+
  scale_fill_manual(values = c("#7fc97f", "#beaed4", "#fdc086"))
```



## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>. This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
